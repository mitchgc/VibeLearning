import"./modulepreload-polyfill-B5Qt9EMX.js";console.log("VibeLearning sidepanel loading...");class i{constructor(){this.currentWorkflow=null,this.currentStep=0,this.currentTab=null,this.currentApp=null,this.availableWorkflows=[],this.init()}async init(){console.log("Initializing VibeLearning sidepanel..."),chrome.runtime.onMessage.addListener((t,e,o)=>(this.handleMessage(t,o),!0)),this.setupEventListeners(),await this.getCurrentTab(),await this.detectApplication(),await this.checkForActiveWorkflow(),console.log("VibeLearning sidepanel initialized")}async getCurrentTab(){try{const t=await chrome.tabs.query({active:!0,currentWindow:!0});this.currentTab=t[0],console.log("Current tab:",this.currentTab?.url)}catch(t){console.error("Error getting current tab:",t)}}setupEventListeners(){const t=document.getElementById("next-step-btn"),e=document.getElementById("skip-tour-btn");t&&t.addEventListener("click",()=>this.nextStep()),e&&e.addEventListener("click",()=>this.skipTour())}handleMessage(t,e){switch(console.log("Sidepanel received message:",t.type,t),t.type){case"START_WORKFLOW":this.startWorkflow(t.workflow),e({success:!0});break;case"UPDATE_STEP":this.updateStep(t.stepIndex),e({success:!0});break;case"CLOSE_WORKFLOW":this.closeWorkflow(),e({success:!0});break;default:e({error:"Unknown message type"})}}async detectApplication(){if(!this.currentTab||!this.currentTab.url){this.showNoWorkflowState();return}const t=this.currentTab.url,e=[{pattern:/youtube\.com/,name:"YouTube",id:"youtube"},{pattern:/github\.com/,name:"GitHub",id:"github"},{pattern:/mail\.google\.com/,name:"Gmail",id:"gmail"}];this.currentApp=e.find(o=>o.pattern.test(t)),this.currentApp?(console.log("Detected app:",this.currentApp.name),await this.loadWorkflows()):(console.log("No supported app detected for:",t),this.showNoWorkflowState())}async loadWorkflows(){try{console.log("Loading workflows for:",this.currentTab?.url);const t=await chrome.runtime.sendMessage({type:"GET_WORKFLOWS",url:this.currentTab?.url||""});console.log("Workflows response:",t),this.availableWorkflows=t?.workflows||[],this.availableWorkflows.length>0?this.showWorkflowSelection():this.showNoWorkflowState()}catch(t){console.error("Failed to load workflows:",t),this.availableWorkflows=[],this.showNoWorkflowState()}}async checkForActiveWorkflow(){try{const t=await chrome.storage.local.get("activeWorkflow");t.activeWorkflow?this.startWorkflow(t.activeWorkflow.workflow,t.activeWorkflow.currentStep):this.availableWorkflows.length===0&&this.showNoWorkflowState()}catch(t){console.error("Error checking for active workflow:",t),this.showNoWorkflowState()}}startWorkflow(t,e=0){console.log("Starting workflow in sidepanel:",t.name),this.currentWorkflow=t,this.currentStep=e,chrome.storage.local.set({activeWorkflow:{workflow:t,currentStep:e}}),this.showWorkflowState(),this.updateCurrentStep()}showWorkflowSelection(){const t=document.getElementById("loading-state"),e=document.getElementById("workflow-selection-state"),o=document.getElementById("no-workflow-state"),r=document.getElementById("workflow-state"),n=document.getElementById("workflow-name");t&&(t.style.display="none"),e&&(e.style.display="flex"),o&&(o.style.display="none"),r&&(r.style.display="none"),n&&(n.textContent="VibeLearning"),this.updateAppInfo(),this.renderWorkflows()}showWorkflowState(){const t=document.getElementById("loading-state"),e=document.getElementById("workflow-selection-state"),o=document.getElementById("no-workflow-state"),r=document.getElementById("workflow-state"),n=document.getElementById("workflow-name");t&&(t.style.display="none"),e&&(e.style.display="none"),o&&(o.style.display="none"),r&&(r.style.display="flex"),n&&this.currentWorkflow&&(n.textContent=this.currentWorkflow.name)}showNoWorkflowState(){const t=document.getElementById("loading-state"),e=document.getElementById("workflow-selection-state"),o=document.getElementById("no-workflow-state"),r=document.getElementById("workflow-state"),n=document.getElementById("workflow-name");t&&(t.style.display="none"),e&&(e.style.display="none"),o&&(o.style.display="block"),r&&(r.style.display="none"),n&&(n.textContent="VibeLearning")}updateAppInfo(){const t=document.getElementById("app-name"),e=document.getElementById("app-badge");t&&this.currentApp&&(t.textContent=this.currentApp.name),e&&(e.textContent="Detected")}renderWorkflows(){const t=document.getElementById("workflow-list");if(t){if(t.innerHTML="",this.availableWorkflows.length===0){t.innerHTML='<p class="loading-workflows">No workflows available for this application.</p>';return}console.log("Rendering workflows:",this.availableWorkflows),this.availableWorkflows.forEach(e=>{const o=document.createElement("div");o.className="workflow-item",o.innerHTML=`
        <div class="workflow-item-header">
          <span class="workflow-name">${e.name}</span>
          <span class="workflow-difficulty ${e.difficulty}">${e.difficulty}</span>
        </div>
        <span class="workflow-time">~${this.getEstimatedTime(e)}</span>
      `,o.addEventListener("click",()=>this.selectWorkflow(e)),t.appendChild(o)})}}getEstimatedTime(t){return{easy:"2 min",medium:"5 min",hard:"10 min"}[t.difficulty]||"5 min"}async selectWorkflow(t){console.log("Selected workflow:",t.id);try{await chrome.runtime.sendMessage({type:"START_WORKFLOW",workflowId:t.id})}catch(e){console.error("Failed to start workflow:",e)}}updateCurrentStep(){if(!this.currentWorkflow||this.currentStep>=this.currentWorkflow.steps.length){this.completeWorkflow();return}const t=this.currentWorkflow.steps[this.currentStep],e=document.getElementById("step-title"),o=document.getElementById("step-counter"),r=document.getElementById("step-instruction"),n=document.getElementById("next-step-btn"),s=document.getElementById("progress-bar");if(e&&(e.textContent=t.title),o&&(o.textContent=`Step ${this.currentStep+1} of ${this.currentWorkflow.steps.length}`),r&&(r.textContent=t.instruction),s){const l=(this.currentStep+1)/this.currentWorkflow.steps.length*100;s.style.width=`${l}%`}if(n){const l=this.currentStep===this.currentWorkflow.steps.length-1;n.textContent=l?"Finish":"Next Step"}this.highlightElement(t),chrome.storage.local.set({activeWorkflow:{workflow:this.currentWorkflow,currentStep:this.currentStep}})}async highlightElement(t){if(this.currentTab)try{await chrome.tabs.sendMessage(this.currentTab.id,{type:"HIGHLIGHT_ELEMENT",selector:t.selector,step:t});const e=document.getElementById("element-warning");e&&(e.style.display="none")}catch(e){console.log("Could not highlight element:",e);const o=document.getElementById("element-warning");o&&(o.style.display="block")}}nextStep(){this.currentWorkflow&&(this.currentStep++,this.updateCurrentStep())}skipTour(){this.closeWorkflow()}closeWorkflow(){if(this.currentWorkflow=null,this.currentStep=0,chrome.storage.local.remove("activeWorkflow"),this.currentTab)try{chrome.tabs.sendMessage(this.currentTab.id,{type:"CLEAR_HIGHLIGHTS"})}catch(t){console.log("Could not clear highlights:",t)}this.availableWorkflows.length>0?this.showWorkflowSelection():this.showNoWorkflowState()}completeWorkflow(){if(!this.currentWorkflow)return;const t=document.getElementById("progress-bar");t&&(t.style.width="100%");const e=document.getElementById("step-title"),o=document.getElementById("step-counter");e&&(e.textContent="ðŸŽ‰ Complete!"),o&&(o.textContent="Workflow finished");const r=document.getElementById("step-instruction"),n=document.getElementById("next-step-btn"),s=document.getElementById("skip-tour-btn");r&&(r.innerHTML=`
        <p style="margin: 0 0 16px 0; color: #059669;">You've successfully completed the "${this.currentWorkflow.name}" workflow!</p>
        <p style="margin: 0; font-size: 13px; color: #6b7280;">Try exploring other workflows or practice this one again to master it.</p>
      `),n&&(n.textContent="Done",n.onclick=()=>this.closeWorkflow()),s&&(s.style.display="none"),setTimeout(()=>{this.closeWorkflow()},8e3)}}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, initializing sidepanel controller..."),new i});
