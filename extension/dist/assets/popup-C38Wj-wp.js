import"./modulepreload-polyfill-B5Qt9EMX.js";console.log("VibeLearning popup loading...");class c{constructor(){this.currentTab=null,this.currentApp=null,this.workflows=[],this.activeWorkflow=null,this.init()}async init(){try{await this.getCurrentTab(),await this.detectApplication(),await this.loadUserStats(),this.setupEventListeners(),console.log("Popup controller initialized")}catch(e){console.error("Error initializing popup:",e)}}async getCurrentTab(){try{const e=await chrome.tabs.query({active:!0,currentWindow:!0});this.currentTab=e[0],console.log("Current tab:",this.currentTab?.url),console.log("Full tab object:",this.currentTab)}catch(e){console.error("Error getting current tab:",e)}}async detectApplication(){if(console.log("detectApplication called, currentTab:",this.currentTab),!this.currentTab||!this.currentTab.url){console.log("No current tab or URL, showing no app detected"),this.showNoAppDetected();return}const e=this.currentTab.url;console.log("Checking URL:",e);const t=[{pattern:/youtube\.com/,name:"YouTube",id:"youtube"},{pattern:/github\.com/,name:"GitHub",id:"github"},{pattern:/mail\.google\.com/,name:"Gmail",id:"gmail"},{pattern:/google\.com/,name:"Google",id:"google"}];this.currentApp=t.find(o=>o.pattern.test(e)),console.log("Found app:",this.currentApp),this.currentApp?(console.log("Detected app:",this.currentApp.name),await this.showAppDetected()):(console.log("No supported app detected for:",e),this.showNoAppDetected())}showNoAppDetected(){const e=document.getElementById("no-app-detected"),t=document.getElementById("app-detected"),o=document.getElementById("workflow-active");e&&e.classList.remove("hidden"),t&&t.classList.add("hidden"),o&&o.classList.add("hidden"),this.updateStatus("No app detected","inactive")}async showAppDetected(){const e=document.getElementById("no-app-detected"),t=document.getElementById("app-detected"),o=document.getElementById("workflow-active");e&&e.classList.add("hidden"),t&&t.classList.remove("hidden"),o&&o.classList.add("hidden");const n=document.getElementById("app-name");n&&(n.textContent=this.currentApp.name),this.updateStatus(`${this.currentApp.name} ready`,"active"),await this.loadWorkflows()}async loadWorkflows(){try{console.log("Loading workflows...");let e=null,t=0;const o=3;for(;!e&&t<o;)try{e=await chrome.runtime.sendMessage({type:"GET_WORKFLOWS",url:this.currentTab?.url||""})}catch(n){t++,console.log(`Attempt ${t} failed, retrying...`,n.message),t<o&&await new Promise(s=>setTimeout(s,200))}console.log("Workflows response:",e),this.workflows=e?.workflows||[],this.renderWorkflows()}catch(e){console.error("Failed to load workflows after retries:",e),this.workflows=[],this.renderWorkflows()}}renderWorkflows(){const e=document.getElementById("workflow-list");if(e){if(e.innerHTML="",this.workflows.length===0){e.innerHTML='<p class="message-box">No workflows available for this application.</p>';return}console.log("Rendering workflows:",this.workflows),this.workflows.forEach(t=>{const o=document.createElement("div");o.className="workflow-item",o.innerHTML=`
        <div class="workflow-item-header">
          <span class="workflow-name">${t.name}</span>
          <span class="workflow-difficulty ${t.difficulty}">${t.difficulty}</span>
        </div>
        <span class="workflow-time">~${this.getEstimatedTime(t)}</span>
      `,o.addEventListener("click",()=>this.startWorkflow(t)),e.appendChild(o)})}}getEstimatedTime(e){return{easy:"2 min",medium:"5 min",hard:"10 min"}[e.difficulty]||"5 min"}async startWorkflow(e){this.activeWorkflow=e,console.log("Starting workflow:",e.id);try{await chrome.runtime.sendMessage({type:"START_WORKFLOW",workflowId:e.id}),this.showActiveWorkflow()}catch(t){console.error("Failed to start workflow:",t)}}showActiveWorkflow(){const e=document.getElementById("app-detected"),t=document.getElementById("workflow-active");e&&e.classList.add("hidden"),t&&t.classList.remove("hidden");const o=document.getElementById("active-workflow-name");o&&(o.textContent=this.activeWorkflow.name),this.updateProgress(1,10),this.updateStatus("Workflow in progress","active")}updateProgress(e,t){const o=e/t*100,n=document.getElementById("progress-fill"),s=document.getElementById("current-step"),i=document.getElementById("total-steps");n&&(n.style.width=`${o}%`),s&&(s.textContent=e),i&&(i.textContent=t)}updateStatus(e,t="active"){const o=document.querySelector(".status-dot"),n=document.querySelector(".status-text");n&&(n.textContent=e);const s={active:"#4CAF50",inactive:"#ccc",warning:"#ff9800",error:"#f44336"};o&&(o.style.background=s[t]||s.active)}async loadUserStats(){try{const t=(await chrome.storage.local.get("userProgress")).userProgress||{completedWorkflows:0,averageTime:0},o=document.getElementById("workflows-completed"),n=document.getElementById("time-saved");o&&(o.textContent=t.completedWorkflows);const s=Math.round(t.completedWorkflows*5);n&&(n.textContent=`${s}m`)}catch(e){console.error("Error loading user stats:",e)}}setupEventListeners(){const e=document.getElementById("enabled-toggle");e&&e.addEventListener("change",r=>{this.toggleExtension(r.target.checked)});const t=document.getElementById("search-workflow");t&&t.addEventListener("click",r=>{r.preventDefault(),this.toggleSearchPanel()});const o=document.getElementById("record-workflow");o&&o.addEventListener("click",r=>{r.preventDefault(),this.startRecording()});const n=document.getElementById("search-input");n&&n.addEventListener("input",r=>{this.searchWorkflows(r.target.value)});const s=document.getElementById("help-link"),i=document.getElementById("feedback-link");s&&s.addEventListener("click",r=>{r.preventDefault(),chrome.tabs.create({url:"https://vibelearning.com/help"})}),i&&i.addEventListener("click",r=>{r.preventDefault(),chrome.tabs.create({url:"https://vibelearning.com/feedback"})})}async toggleExtension(e){try{await chrome.storage.local.set({settings:{enabled:e}}),this.updateStatus(e?"Ready":"Disabled",e?"active":"inactive")}catch(t){console.error("Error toggling extension:",t)}}toggleSearchPanel(){const e=document.getElementById("search-panel");if(e&&(e.classList.toggle("hidden"),!e.classList.contains("hidden"))){const t=document.getElementById("search-input");t&&setTimeout(()=>t.focus(),100),this.renderSearchResults(this.workflows)}}async searchWorkflows(e){if(!e){this.renderSearchResults(this.workflows);return}const t=this.workflows.filter(o=>o.name.toLowerCase().includes(e.toLowerCase())||o.difficulty.toLowerCase().includes(e.toLowerCase()));this.renderSearchResults(t)}renderSearchResults(e){const t=document.getElementById("search-results");if(t){if(t.innerHTML="",e.length===0){t.innerHTML='<p style="text-align: center; color: #999; padding: 16px;">No workflows found</p>';return}e.forEach(o=>{const n=document.createElement("div");n.className="workflow-item",n.innerHTML=`
        <div class="workflow-item-header">
          <span class="workflow-name">${o.name}</span>
          <span class="workflow-difficulty ${o.difficulty}">${o.difficulty}</span>
        </div>
        <span class="workflow-time">~${this.getEstimatedTime(o)}</span>
      `,n.addEventListener("click",()=>{this.startWorkflow(o),this.toggleSearchPanel()}),t.appendChild(n)})}}async startRecording(){this.showNotification("Recording feature coming soon!","info"),console.log("Starting workflow recording...")}showNotification(e,t="info"){const o=document.createElement("div");o.style.cssText=`
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: ${t==="info"?"#2196F3":"#4CAF50"};
      color: white;
      padding: 12px 16px;
      border-radius: 6px;
      z-index: 999999;
      font-size: 14px;
    `,o.textContent=e,document.body.appendChild(o),setTimeout(()=>{o.parentElement&&o.remove()},3e3)}}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, initializing popup controller..."),new c});
