function U(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var E={exports:{}},B=E.exports,O;function D(){return O||(O=1,(function(x,e){(function(t,i){i(x)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:B,function(t){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const i="The message port closed before a response was received.",a=g=>{const h={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(h).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class A extends WeakMap{constructor(s,o=void 0){super(o),this.createItem=s}get(s){return this.has(s)||this.set(s,this.createItem(s)),super.get(s)}}const v=r=>r&&typeof r=="object"&&typeof r.then=="function",y=(r,s)=>(...o)=>{g.runtime.lastError?r.reject(new Error(g.runtime.lastError.message)):s.singleCallbackArg||o.length<=1&&s.singleCallbackArg!==!1?r.resolve(o[0]):r.resolve(o)},C=r=>r==1?"argument":"arguments",W=(r,s)=>function(l,...m){if(m.length<s.minArgs)throw new Error(`Expected at least ${s.minArgs} ${C(s.minArgs)} for ${r}(), got ${m.length}`);if(m.length>s.maxArgs)throw new Error(`Expected at most ${s.maxArgs} ${C(s.maxArgs)} for ${r}(), got ${m.length}`);return new Promise((d,p)=>{if(s.fallbackToNoCallback)try{l[r](...m,y({resolve:d,reject:p},s))}catch(n){console.warn(`${r} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,n),l[r](...m),s.fallbackToNoCallback=!1,s.noCallback=!0,d()}else s.noCallback?(l[r](...m),d()):l[r](...m,y({resolve:d,reject:p},s))})},F=(r,s,o)=>new Proxy(s,{apply(l,m,d){return o.call(m,r,...d)}});let S=Function.call.bind(Object.prototype.hasOwnProperty);const _=(r,s={},o={})=>{let l=Object.create(null),m={has(p,n){return n in r||n in l},get(p,n,b){if(n in l)return l[n];if(!(n in r))return;let c=r[n];if(typeof c=="function")if(typeof s[n]=="function")c=F(r,r[n],s[n]);else if(S(o,n)){let w=W(n,o[n]);c=F(r,r[n],w)}else c=c.bind(r);else if(typeof c=="object"&&c!==null&&(S(s,n)||S(o,n)))c=_(c,s[n],o[n]);else if(S(o,"*"))c=_(c,s[n],o["*"]);else return Object.defineProperty(l,n,{configurable:!0,enumerable:!0,get(){return r[n]},set(w){r[n]=w}}),c;return l[n]=c,c},set(p,n,b,c){return n in l?l[n]=b:r[n]=b,!0},defineProperty(p,n,b){return Reflect.defineProperty(l,n,b)},deleteProperty(p,n){return Reflect.deleteProperty(l,n)}},d=Object.create(r);return new Proxy(d,m)},T=r=>({addListener(s,o,...l){s.addListener(r.get(o),...l)},hasListener(s,o){return s.hasListener(r.get(o))},removeListener(s,o){s.removeListener(r.get(o))}}),z=new A(r=>typeof r!="function"?r:function(o){const l=_(o,{},{getContent:{minArgs:0,maxArgs:0}});r(l)}),N=new A(r=>typeof r!="function"?r:function(o,l,m){let d=!1,p,n=new Promise(k=>{p=function(f){d=!0,k(f)}}),b;try{b=r(o,l,p)}catch(k){b=Promise.reject(k)}const c=b!==!0&&v(b);if(b!==!0&&!c&&!d)return!1;const w=k=>{k.then(f=>{m(f)},f=>{let P;f&&(f instanceof Error||typeof f.message=="string")?P=f.message:P="An unexpected error occurred",m({__mozWebExtensionPolyfillReject__:!0,message:P})}).catch(f=>{console.error("Failed to send onMessage rejected reply",f)})};return w(c?b:n),!0}),I=({reject:r,resolve:s},o)=>{g.runtime.lastError?g.runtime.lastError.message===i?s():r(new Error(g.runtime.lastError.message)):o&&o.__mozWebExtensionPolyfillReject__?r(new Error(o.message)):s(o)},M=(r,s,o,...l)=>{if(l.length<s.minArgs)throw new Error(`Expected at least ${s.minArgs} ${C(s.minArgs)} for ${r}(), got ${l.length}`);if(l.length>s.maxArgs)throw new Error(`Expected at most ${s.maxArgs} ${C(s.maxArgs)} for ${r}(), got ${l.length}`);return new Promise((m,d)=>{const p=I.bind(null,{resolve:m,reject:d});l.push(p),o.sendMessage(...l)})},R={devtools:{network:{onRequestFinished:T(z)}},runtime:{onMessage:T(N),onMessageExternal:T(N),sendMessage:M.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:M.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},L={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return h.privacy={network:{"*":L},services:{"*":L},websites:{"*":L}},_(g,R,h)};t.exports=a(chrome)}})})(E)),E.exports}var $=D();const u=U($);class j{constructor(){this.activeWorkflows=new Map,this.userSettings={enabled:!0,autoDetect:!0,learningMode:"adaptive"},this.init()}async init(){await this.loadUserSettings(),this.setupListeners(),console.log("VibeLearning background service initialized")}async loadUserSettings(){try{const e=await chrome.storage.local.get("settings");this.userSettings=e.settings||{enabled:!0,autoDetect:!0,learningMode:"adaptive"}}catch(e){console.error("Failed to load user settings:",e)}}setupListeners(){chrome.runtime.onMessage.addListener((e,t,i)=>(this.handleMessage(e,t,i),!0)),chrome.action.onClicked.addListener(async e=>{await chrome.sidePanel.open({windowId:e.windowId})}),chrome.tabs.onUpdated.addListener((e,t,i)=>{t.status==="complete"&&this.checkForSupportedApp(i)}),chrome.runtime.onStartup.addListener(()=>{console.log("VibeLearning service worker started")}),chrome.runtime.onInstalled.addListener(()=>{console.log("VibeLearning extension installed/updated")})}async handleMessage(e,t,i){try{switch(e.type){case"START_WORKFLOW":console.log("Received START_WORKFLOW message:",e.workflowId);let a=t.tab;if(!a){console.log("No sender tab, getting current active tab");try{a=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0],console.log("Got current active tab:",a?.id,a?.url)}catch(y){console.error("Failed to get current active tab:",y),i({error:"Could not get current tab"});return}}if(!a){i({error:"No tab available"});return}const g=await this.startWorkflow(e.workflowId,a);i({success:!0,workflow:g});break;case"GET_ELEMENT":if(!t.tab){i({error:"No tab context available"});return}const h=await this.findElement(e.intent,e.context,t.tab);i({success:!0,element:h});break;case"WORKFLOW_STEP_COMPLETE":await this.recordStepCompletion(e.workflowId,e.stepId,e.data),i({success:!0});break;case"GET_WORKFLOWS":let A=e.url;if(!A&&t.tab?.url)A=t.tab.url;else if(!A)try{A=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0]?.url||""}catch{A=""}const v=await this.getAvailableWorkflows(A);i({workflows:v});break;case"REPORT_ERROR":if(!t.tab){i({error:"No tab context available"});return}await this.handleError(e.error,t.tab),i({success:!0});break;case"LEARN_ELEMENT":if(!t.tab){i({error:"No tab context available"});return}await this.learnElementPattern(e.element,e.intent,t.tab),i({success:!0});break;default:i({error:"Unknown request type"})}}catch(a){console.error("Error handling message:",a),i({error:a.message||"Unknown error occurred"})}}async startWorkflow(e,t){console.log("Starting workflow:",e,"for tab:",t.id);const i=await this.loadWorkflow(e);if(console.log("Loaded workflow:",i),!i)throw console.error("No workflow found for ID:",e),new Error("Workflow not found");this.activeWorkflows.set(t.id,{workflow:i,currentStep:0,startTime:Date.now(),tabId:t.id}),console.log("Sending workflow to side panel");try{await chrome.runtime.sendMessage({type:"START_WORKFLOW",workflow:i}),console.log("Workflow sent to side panel")}catch(a){throw console.error("Failed to send workflow to side panel:",a),a}return i}async loadWorkflow(e){return this.getLocalWorkflow(e)}async getLocalWorkflow(e){return{create_playlist:{id:"create_playlist",name:"Create a Playlist",description:"Learn how to create a new playlist on YouTube",steps:[{id:"step1",title:"Navigate to Library",instruction:'Click on "Library" in the left sidebar to access your playlists.',intent:"click",target:"library_link",selector:'a[href="/feed/library"]',position:"right"},{id:"step2",title:"Find Playlists Section",instruction:'Look for the "Playlists" section in your library.',intent:"highlight",target:"playlists_section",selector:"#playlists",position:"bottom"},{id:"step3",title:"Create New Playlist",instruction:'Click "New playlist" or the "+" button to create a playlist.',intent:"click",target:"new_playlist_button",selector:'button[aria-label="Create playlist"], ytd-button-renderer:has-text("New playlist")',position:"bottom"},{id:"step4",title:"Enter Playlist Name",instruction:"Enter a name for your new playlist in the text field.",intent:"input",target:"playlist_name_input",selector:'input[placeholder*="playlist" i], input[placeholder*="name" i]',position:"top"},{id:"step5",title:"Set Privacy",instruction:"Choose whether your playlist should be public, unlisted, or private.",intent:"click",target:"privacy_dropdown",selector:"tp-yt-paper-dropdown-menu",position:"left"},{id:"step6",title:"Create Playlist",instruction:'Click "Create" to finish creating your playlist.',intent:"click",target:"create_button",selector:'button:has-text("Create"), ytd-button-renderer:has-text("Create")',position:"bottom"}]},upload_video:{id:"upload_video",name:"Upload a Video",description:"Learn how to upload a video to YouTube",steps:[{id:"step1",title:"Click Create Button",instruction:'Click the "Create" button (camera icon) in the top right corner.',intent:"click",target:"create_button",selector:'ytd-topbar-menu-button-renderer button[aria-label*="Create"]',position:"bottom"},{id:"step2",title:"Select Upload Video",instruction:'Click "Upload video" from the dropdown menu.',intent:"click",target:"upload_video_option",selector:'tp-yt-paper-item:has-text("Upload video")',position:"left"},{id:"step3",title:"Select Files",instruction:'Click "SELECT FILES" to choose a video from your computer.',intent:"click",target:"select_files_button",selector:'input[type="file"], button:has-text("SELECT FILES")',position:"top"},{id:"step4",title:"Add Title",instruction:"Enter a title for your video in the title field.",intent:"input",target:"video_title_input",selector:'input[placeholder*="title" i], textarea[placeholder*="title" i]',position:"right"},{id:"step5",title:"Add Description",instruction:"Write a description for your video (optional but recommended).",intent:"input",target:"video_description",selector:'textarea[placeholder*="description" i]',position:"right"},{id:"step6",title:"Set Visibility",instruction:"Choose whether your video should be public, unlisted, or private.",intent:"click",target:"visibility_dropdown",selector:"tp-yt-paper-radio-button",position:"left"},{id:"step7",title:"Publish Video",instruction:'Click "PUBLISH" to upload your video to YouTube.',intent:"click",target:"publish_button",selector:'button:has-text("PUBLISH")',position:"bottom"}]},customize_channel:{id:"customize_channel",name:"Customize Your Channel",description:"Learn how to customize your YouTube channel",steps:[{id:"step1",title:"Go to Your Channel",instruction:'Click your profile picture and select "Your channel" from the menu.',intent:"click",target:"profile_menu",selector:'button[aria-label*="Account menu"]',position:"bottom"},{id:"step2",title:"Customize Channel",instruction:'Click "Customize channel" to access channel settings.',intent:"click",target:"customize_button",selector:'a[href*="customize"]:has-text("Customize")',position:"bottom"},{id:"step3",title:"Upload Channel Art",instruction:"Click on the camera icon to upload channel art/banner.",intent:"click",target:"upload_banner",selector:'input[accept*="image"], button:has-text("Upload")',position:"top"}]},enable_monetization:{id:"enable_monetization",name:"Enable Monetization",description:"Learn how to enable monetization on your YouTube channel",steps:[{id:"step1",title:"Go to YouTube Studio",instruction:'Click your profile picture and select "YouTube Studio".',intent:"click",target:"youtube_studio",selector:'a[href*="studio"]:has-text("YouTube Studio")',position:"bottom"},{id:"step2",title:"Access Monetization",instruction:'In the left sidebar, click on "Monetization".',intent:"click",target:"monetization_menu",selector:'a[href*="monetization"]',position:"right"},{id:"step3",title:"Start Application",instruction:'Click "Get started" to begin the monetization application process.',intent:"click",target:"get_started",selector:'button:has-text("Get started")',position:"bottom"}]},organize_inbox:{id:"organize_inbox",name:"Organize Your Inbox",description:"Learn how to organize your Gmail inbox efficiently",steps:[{id:"step1",title:"Check Unread Emails",instruction:"Look at your inbox and identify unread emails (bold text).",intent:"highlight",target:"unread_emails",selector:".zA.zE:not(.yW)",position:"right"},{id:"step2",title:"Create Labels",instruction:'Click "Labels" in the left sidebar to create new labels for organizing.',intent:"click",target:"labels_menu",selector:'a[href*="label"]',position:"right"},{id:"step3",title:"Apply Labels",instruction:"Select emails and click the labels icon to categorize them.",intent:"click",target:"label_button",selector:'div[data-tooltip*="Label"]',position:"bottom"},{id:"step4",title:"Archive Old Emails",instruction:"Select old emails and click Archive to clean up your inbox.",intent:"click",target:"archive_button",selector:'div[data-tooltip*="Archive"]',position:"bottom"}]},create_filters:{id:"create_filters",name:"Create Email Filters",description:"Learn how to create filters for automatic email organization",steps:[{id:"step1",title:"Open Settings",instruction:'Click the gear icon in the top right and select "Settings".',intent:"click",target:"settings_gear",selector:'button[aria-label*="Settings"]',position:"bottom"},{id:"step2",title:"Go to Filters",instruction:'Click on "Filters and Blocked Addresses" tab.',intent:"click",target:"filters_tab",selector:'span:has-text("Filters and Blocked Addresses")',position:"bottom"},{id:"step3",title:"Create New Filter",instruction:'Click "Create a new filter" to set up automatic email rules.',intent:"click",target:"create_filter",selector:'a:has-text("Create a new filter")',position:"bottom"},{id:"step4",title:"Set Filter Criteria",instruction:"Enter criteria like sender email or subject keywords.",intent:"input",target:"filter_from",selector:'input[name="from"]',position:"top"}]},setup_signature:{id:"setup_signature",name:"Setup Email Signature",description:"Learn how to create and setup an email signature",steps:[{id:"step1",title:"Open Settings",instruction:'Click the gear icon in the top right and select "Settings".',intent:"click",target:"settings_gear",selector:'button[aria-label*="Settings"]',position:"bottom"},{id:"step2",title:"Find Signature Section",instruction:'Scroll down to find the "Signature" section in General settings.',intent:"highlight",target:"signature_section",selector:'td:has-text("Signature")',position:"right"},{id:"step3",title:"Create Signature",instruction:'Click "Create new" to add a new email signature.',intent:"click",target:"create_signature",selector:'div[role="button"]:has-text("Create new")',position:"bottom"},{id:"step4",title:"Edit Signature",instruction:"Type your signature text and format it as desired.",intent:"input",target:"signature_editor",selector:'div[contenteditable="true"]',position:"top"}]}}[e]||null}async findElement(e,t,i){try{const a=await fetch("http://localhost:3000/api/element-finder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({intent:e,context:t,url:i.url,companyId:await this.getCompanyId(i.url)})});return a.ok?a.json():await this.fallbackElementFinder(e,t,i)}catch(a){return console.error("Element finder API error:",a),await this.fallbackElementFinder(e,t,i)}}async fallbackElementFinder(e,t,i){return await u.tabs.sendMessage(i.id,{type:"FIND_ELEMENT_LOCAL",intent:e,context:t})}async getCompanyId(e){const t=new URL(e).hostname;return(await u.storage.local.get("companyId")).companyId||t}async checkForSupportedApp(e){if(!e.url)return;const i=[{pattern:/workday\.com/,name:"Workday"},{pattern:/salesforce\.com/,name:"Salesforce"},{pattern:/servicenow\.com/,name:"ServiceNow"},{pattern:/concur\.com/,name:"Concur"}].find(a=>a.pattern.test(e.url));i&&this.userSettings.autoDetect&&(await u.action.setBadgeText({text:"!",tabId:e.id}),await u.action.setBadgeBackgroundColor({color:"#4CAF50",tabId:e.id}),await u.tabs.sendMessage(e.id,{type:"APP_DETECTED",appName:i.name}))}async recordStepCompletion(e,t,i){const a=Date.now(),g={workflowId:e,stepId:t,timestamp:a,success:i.success,duration:i.duration,elementFound:i.elementFound};await u.storage.local.get("analytics").then(h=>{const A=h.analytics||[];return A.push(g),u.storage.local.set({analytics:A})}),i.elementSelector&&await this.cacheElementSelector(e,t,i.elementSelector)}async cacheElementSelector(e,t,i){const a=`selector_${e}_${t}`;await u.storage.local.set({[a]:i})}async learnElementPattern(e,t,i){const a={intent:t,selector:e.selector,text:e.text,attributes:e.attributes,url:i.url,timestamp:Date.now()};await u.storage.local.get("patterns").then(g=>{const h=g.patterns||[];return h.push(a),u.storage.local.set({patterns:h})});try{await fetch("http://localhost:3000/api/patterns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}catch(g){console.error("Failed to sync pattern:",g)}}async toggleExtension(e){this.userSettings.enabled=!this.userSettings.enabled,await u.storage.local.set({settings:this.userSettings});const t=this.userSettings.enabled?"":"OFF";await u.action.setBadgeText({text:t,tabId:e.id}),await u.tabs.sendMessage(e.id,{type:"TOGGLE_EXTENSION",enabled:this.userSettings.enabled})}async handleError(e,t){console.error("Workflow error:",e);const i={error:e.message,stack:e.stack,url:t.url,timestamp:Date.now()};await u.storage.local.get("errors").then(a=>{const g=a.errors||[];return g.push(i),u.storage.local.set({errors:g.slice(-100)})})}async getAvailableWorkflows(e){console.log("Getting workflows for URL:",e);try{const t=new URL(e).hostname;return console.log("Domain:",t),t.includes("youtube.com")?[{id:"create_playlist",name:"Create a Playlist",difficulty:"easy"},{id:"upload_video",name:"Upload a Video",difficulty:"medium"},{id:"customize_channel",name:"Customize Your Channel",difficulty:"medium"},{id:"enable_monetization",name:"Enable Monetization",difficulty:"hard"}]:t.includes("github.com")?[{id:"create_repository",name:"Create New Repository",difficulty:"easy"},{id:"create_pull_request",name:"Create Pull Request",difficulty:"medium"},{id:"setup_actions",name:"Setup GitHub Actions",difficulty:"hard"}]:t.includes("mail.google.com")?[{id:"organize_inbox",name:"Organize Your Inbox",difficulty:"easy"},{id:"create_filters",name:"Create Email Filters",difficulty:"medium"},{id:"setup_signature",name:"Setup Email Signature",difficulty:"easy"}]:t.includes("workday.com")?[{id:"expense_submission",name:"Submit Expense Report",difficulty:"medium"},{id:"add_expense_items",name:"Add Expense Items",difficulty:"easy"},{id:"attach_receipts",name:"Attach Receipts",difficulty:"easy"},{id:"check_approval_status",name:"Check Approval Status",difficulty:"easy"},{id:"recall_submission",name:"Recall Submission",difficulty:"medium"}]:(console.log("No workflows found for domain:",t),[])}catch(t){return console.error("Error parsing URL or getting workflows:",t),[]}}}new j;
